//
//  CodeInputWorker.swift
//  Qorum
//
//  Created by Stanislav on 09.04.2018.
//  Copyright (c) 2018 Bizico. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit

class CodeInputWorker {
    
    /// Verifies code from sms
    ///
    /// - Parameters:
    ///   - code: code string to verify
    ///   - phone: phone number received the code
    ///   - completion: completion block
    func verify(code: String,
                phone: NumberInput.Phone,
                completion: @escaping APIHandler<Bool>) {
        let user = User.stored
        let request = VerificationRequest(target: .checkPhoneVerification(userId: user.userId,
                                                                          countryCode: phone.countryCode,
                                                                          phoneNumber: phone.phoneNumber,
                                                                          code: code))
        request.perform { response in
            switch response.result {
            case let .value(json):
                guard json["success"].boolValue else {
                    completion(.value(false))
                    return
                }
                completion(.value(true))
            case let .error(error):
                completion(.error(error))
            }
        }
    }
    
}

